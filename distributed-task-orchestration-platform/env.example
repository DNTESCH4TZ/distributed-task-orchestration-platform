# ========================================
# APPLICATION SETTINGS
# ========================================
ENVIRONMENT=development
DEBUG=True
APP_NAME="Task Orchestrator"
APP_VERSION=0.1.0
API_V1_PREFIX=/api/v1

# Performance tuning for 1M RPS
WORKERS=4  # Number of uvicorn workers (CPU cores * 2)
WORKER_CONNECTIONS=1000  # Max concurrent connections per worker
BACKLOG=2048  # Socket listen backlog

# ========================================
# DATABASE - PostgreSQL
# ========================================
DATABASE_URL=postgresql+asyncpg://orchestrator:orchestrator@localhost:5432/task_orchestrator
DATABASE_POOL_SIZE=20  # Connection pool size per worker
DATABASE_MAX_OVERFLOW=10  # Max overflow connections
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
DATABASE_ECHO=False  # Set to True for SQL query logging

# Read replica for CQRS (optional)
DATABASE_READ_URL=postgresql+asyncpg://orchestrator:orchestrator@localhost:5433/task_orchestrator

# ========================================
# REDIS - Cache & Pub/Sub
# ========================================
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=50  # Connection pool size
REDIS_SOCKET_KEEPALIVE=True
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_HEALTH_CHECK_INTERVAL=30

# Redis for Celery results
REDIS_CELERY_URL=redis://localhost:6379/1

# Redis for rate limiting
REDIS_RATE_LIMIT_URL=redis://localhost:6379/2

# ========================================
# MESSAGE QUEUE - RabbitMQ
# ========================================
RABBITMQ_URL=amqp://guest:guest@localhost:5672//
CELERY_BROKER_URL=amqp://guest:guest@localhost:5672//
CELERY_RESULT_BACKEND=redis://localhost:6379/1
CELERY_TASK_SERIALIZER=msgpack  # Faster than JSON
CELERY_RESULT_SERIALIZER=msgpack
CELERY_ACCEPT_CONTENT=["msgpack", "json"]
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=True

# Celery performance tuning
CELERY_WORKER_PREFETCH_MULTIPLIER=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000
CELERY_TASK_ACKS_LATE=True
CELERY_TASK_REJECT_ON_WORKER_LOST=True

# ========================================
# CLICKHOUSE - Analytics
# ========================================
CLICKHOUSE_HOST=localhost
CLICKHOUSE_PORT=9000
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=
CLICKHOUSE_DATABASE=task_orchestrator_analytics

# ========================================
# SECURITY
# ========================================
SECRET_KEY=your-super-secret-key-change-in-production-min-32-chars
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# CORS
CORS_ORIGINS=["http://localhost:3000", "http://localhost:8000"]
CORS_ALLOW_CREDENTIALS=True
CORS_ALLOW_METHODS=["*"]
CORS_ALLOW_HEADERS=["*"]

# ========================================
# OBSERVABILITY - Prometheus
# ========================================
PROMETHEUS_ENABLED=True
PROMETHEUS_PORT=9090

# ========================================
# TRACING - Jaeger
# ========================================
JAEGER_ENABLED=True
JAEGER_AGENT_HOST=localhost
JAEGER_AGENT_PORT=6831
JAEGER_SAMPLER_TYPE=probabilistic
JAEGER_SAMPLER_PARAM=0.1  # Sample 10% of requests

# ========================================
# LOGGING
# ========================================
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text
LOG_FILE=logs/app.log

# ========================================
# RATE LIMITING
# ========================================
RATE_LIMIT_ENABLED=True
RATE_LIMIT_PER_MINUTE=1000  # Per IP
RATE_LIMIT_PER_HOUR=10000

# ========================================
# CIRCUIT BREAKER
# ========================================
CIRCUIT_BREAKER_FAIL_THRESHOLD=5
CIRCUIT_BREAKER_TIMEOUT=60
CIRCUIT_BREAKER_EXPECTED_EXCEPTION=Exception

# ========================================
# RETRY POLICY
# ========================================
DEFAULT_MAX_RETRIES=3
DEFAULT_RETRY_BACKOFF_BASE=2  # Exponential: 2^attempt seconds
DEFAULT_RETRY_BACKOFF_MAX=60

# ========================================
# WORKFLOW SETTINGS
# ========================================
MAX_WORKFLOW_DEPTH=10  # Max nested workflow depth
MAX_PARALLEL_TASKS=100  # Max parallel tasks per workflow
TASK_TIMEOUT_DEFAULT=300  # Default task timeout in seconds
WORKFLOW_RETENTION_DAYS=30  # How long to keep completed workflows

# ========================================
# PERFORMANCE MONITORING
# ========================================
SLOW_QUERY_THRESHOLD_MS=100  # Log queries slower than this
REQUEST_TIMEOUT=30  # HTTP request timeout in seconds

# ========================================
# TESTING
# ========================================
TESTING=False
TEST_DATABASE_URL=postgresql+asyncpg://orchestrator:orchestrator@localhost:5432/task_orchestrator_test

